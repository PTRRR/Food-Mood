!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.workerTimersBroker=e.workerTimersBroker||{})}(this,function(e){"use strict";var t=function(e){return void 0!==e.method&&"call"===e.method},r=function(e){return null===e.error&&"number"==typeof e.id},i=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,n=function(e){for(var t=Math.round(Math.random()*i);e.has(t);)t=Math.round(Math.random()*i);return t},o=function(e){var i=new Map,o=new Map,a=new Map,d=new Worker(e);return d.addEventListener("message",function(e){var n=e.data;if(t(n)){var d=n.params,s=d.timerId,m=d.timerType;if("interval"===m){var f=i.get(s);if("number"==typeof f){var u=a.get(f);if(void 0===u||u.timerId!==s||u.timerType!==m)throw new Error("The timer is in an undefined state.")}else{if(void 0===f)throw new Error("The timer is in an undefined state.");f()}}else if("timeout"===m){var p=o.get(s);if("number"==typeof p){var l=a.get(p);if(void 0===l||l.timerId!==s||l.timerType!==m)throw new Error("The timer is in an undefined state.")}else{if(void 0===p)throw new Error("The timer is in an undefined state.");p(),o.delete(s)}}}else{if(!r(n)){console.log(n);var v=n.error.message;throw new Error(v)}var c=n.id,h=a.get(c);if(void 0===h)throw new Error("The timer is in an undefined state.");var w=h.timerId,y=h.timerType;a.delete(c),"interval"===y?i.delete(w):o.delete(w)}}),{clearInterval:function(e){var t=n(a);a.set(t,{timerId:e,timerType:"interval"}),i.set(e,t),d.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:function(e){var t=n(a);a.set(t,{timerId:e,timerType:"timeout"}),o.set(e,t),d.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:function(e,t){var r=n(i);return i.set(r,function(){e(),"function"==typeof i.get(r)&&d.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:r,timerType:"interval"}})}),d.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:r,timerType:"interval"}}),r},setTimeout:function(e,t){var r=n(o);return o.set(r,e),d.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:r,timerType:"timeout"}}),r}}};e.load=o,Object.defineProperty(e,"__esModule",{value:!0})});